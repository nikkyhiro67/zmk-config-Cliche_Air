/*
 * Cliche_Air 共通ハードウェア定義
 */

 / {
    chosen {
        zmk,kscan = &kscan0;
    };

    /* matrix-transform (map削除済み) */
    default_transform: keymap_transform_0 {
        compatible = "zmk,matrix-transform";
        columns = <11>;
        rows = <4>;
    };

    /* Keyscan controller */
    kscan0: kscan {
        compatible = "zmk,kscan-gpio-matrix";
        label = "KSCAN";
        diode-direction = "col2row";
        row-gpios = <&xiao_d 1 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>,
                    <&xiao_d 2 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>,
                    <&xiao_d 3 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>,
                    <&xiao_d 6 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>;
        status = "okay";
    };

    /* Rotary encoder (共通定義) */
    left_encoder: encoder_left {
        compatible = "alps,ec11";
        a-gpios = <&xiao_d 5 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        b-gpios = <&xiao_d 0 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        steps = <24>;
        status = "disabled";
    };

    right_encoder: encoder_right {
        status = "disabled";
    };

    /* --- 修正箇所: sensors ノード --- */
    sensors: sensors {
        compatible = "zmk,keymap-sensors";
        sensors = <&left_encoder>;   /* ← 単体参照に変更 */
        triggers-per-rotation = <10>;
        status = "okay";
    };
};

/* 外部電源制御 */
ext_power: ext_power {
    compatible = "zmk,ext-power-transient";
    gpios = <&gpio0 17 GPIO_ACTIVE_HIGH>;
    status = "okay";
};

/* LEDストリップ制御 */
led_strip: led_strip {
    compatible = "zmk,led-stripnize";
    gpios = <&gpio0 18 GPIO_ACTIVE_HIGH>;
    status = "okay";
};

/* ADC有効化 */
&adc {
    status = "okay";
};

#include "Cliche_Air.dtsi"
#include <input/processors.dtsi>

/* =========================================
 * 右手ユニット（Peripheral）：キー＋トラックボール＋バッテリ＋LED
 * ========================================= */

/ {
    /* Trackball（PMW3610例） */
    trackball: pmw3610@0 {
        compatible = "pixart,pmw3610";
        reg = <0>;
        spi-max-frequency = <2000000>;
        sck-pin = <5>;     /* P0.05 */
        mosi-pin = <4>;    /* P0.04 */
        cs-pin = <9>;      /* P0.09 */
        motion-pin = <10>; /* P1.10 */
        status = "okay";
    };

    /* Non-LiPo バッテリ管理 */
    non_lipo_battery_right: non_lipo_battery_right {
        compatible = "zmk,non-lipo-battery";
        io-channels = <&adc 0>;
        full-mv = <4200>;
        empty-mv = <3300>;
        status = "okay";
    };

    /* Battery Monitor */
    battery_monitor_right: battery_monitor_right {
        compatible = "zmk,battery-monitor";
        manager = <&non_lipo_battery_right>;
        status = "okay";
    };

    /* LED Indicator */
    led_indicator_right: led_indicator_right {
        compatible = "zmk,led-indicator";
        led-strip = <&sk6812_led>;
        battery = <&battery_monitor_right>;
        power-gpios = <&gpio1 0 GPIO_ACTIVE_HIGH>; /* LED_EN -> P1.00 */
        status = "okay";
    };

    chosen {
        zmk,battery = &non_lipo_battery_right;
    };

    aliases {
        trackball0 = &trackball;
        battery-monitor = &battery_monitor_right;
        led-indicator = &led_indicator_right;
    };
};

/* ADC設定（P0.02） */
&saadc {
    status = "okay";

    channel@0 {
        reg = <0>;
        zephyr,gain = "ADC_GAIN_1_6";
        zephyr,reference = "ADC_REF_INTERNAL";
        zephyr,acquisition-time = <10>;
        zephyr,input-positive = <NRF_SAADC_AIN0>;
        zephyr,resolution = <12>;
    };
};

